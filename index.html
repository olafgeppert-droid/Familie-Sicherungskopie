<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Familienringe â€“ Stammbaum & Verwaltung</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Login Overlay -->
  <div class="overlay" id="loginOverlay">
    <div class="login-card glass">
      <h2>ğŸ” Familienringe</h2>
      <p>Bitte Passwort eingeben, um die App zu Ã¶ffnen.</p>
      <input id="pwd" type="password" placeholder="Passwort" />
      <button id="btnLogin" class="primary">Anmelden</button>
      <div id="loginMsg" class="error" aria-live="polite"></div>
    </div>
  </div>

  <header class="topbar glass no-print">
    <div class="brand">
      <div class="logo">ğŸ’</div>
      <div>
        <h1>Familienringe â€“ Stammbaum</h1>
        <small>lokal gespeichert â€¢ exportierbar â€¢ druckbar</small>
      </div>
    </div>
    <div class="toolbar">
      <button id="btnAdd" class="primary">â• Person</button>
      <button id="btnAddPartner">â¤ï¸ Partner</button>
      <button id="btnUndo" title="RÃ¼ckgÃ¤ngig">â†¶ RÃ¼ckgÃ¤ngig</button>
      <button id="btnRedo" title="Wiederholen">â†· Wiederholen</button>
      <input id="search" type="search" placeholder="ğŸ” Suche (Name oder Code)" />
      <button id="btnSearch">Suchen</button>
      <button id="btnShowAll">Alle</button>
      <div class="spacer"></div>
      <button id="btnDraw">ğŸŒ³ Baum aktualisieren</button>
      <button id="btnExport">ğŸ’¾ Export</button>
      <button id="btnExportCsv">ğŸ“„ CSV</button>
      <label class="file-label" title="JSON importieren">
        â¤´ï¸ Import <input id="fileImport" type="file" accept="application/json" />
      </label>
      <button id="btnPrintTable" title="Tabelle drucken">ğŸ–¨ï¸ Tabelle</button>
      <button id="btnPrintTree" title="Baum drucken">ğŸ–¨ï¸ Baum</button>
    </div>
  </header>

  <main>
    <section id="paneTable" class="pane glass">
      <h3>ğŸ“„ Personen â€“ Tabelle</h3>
      <div class="table-wrap">
        <table id="peopleTable">
          <thead>
            <tr>
              <th>Personenâ€‘Code</th>
              <th>Name</th>
              <th>Geburtsdatum</th>
              <th>Geburtsort</th>
              <th>Geschlecht</th>
              <th>Generation</th>
              <th>Elternâ€‘Code</th>
              <th>Partnerâ€‘Code</th>
              <th>Geerbt von</th>
              <th>Ringâ€‘Code</th>
              <th>Kommentar</th>
              <th class="no-print">Aktion</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section id="paneTree" class="pane glass">
      <h3>ğŸŒ³ Grafischer Stammbaum</h3>
      <div class="tree-wrap">
        <svg id="treeSvg" width="1400" height="700" role="img" aria-label="Stammbaum"></svg>
      </div>
    </section>
  </main>

  <footer class="footer muted no-print">
    <small>Tipps: Suche funktioniert mit Namen oder Codes (z.â€¯B. â€1Câ€œ). Daten werden im Browser gespeichert (localStorage).</small>
  </footer>

  <!-- Dialog: Person hinzufÃ¼gen -->
  <dialog id="dlgAdd" class="dlg">
    <form id="formAdd">
      <h3>â• Person hinzufÃ¼gen</h3>
      <div class="grid">
        <label>Elternâ€‘Code <input name="parentCode" placeholder="z.â€¯B. 1 oder 1A" /></label>
        <label>Name <input name="name" /></label>
        <label>Geburtsdatum <input name="birthDate" placeholder="TT.MM.JJJJ" /></label>
        <label>Geburtsort <input name="birthPlace" /></label>
        <label>Geschlecht
          <select name="gender">
            <option value="">â€“</option>
            <option value="m">m</option>
            <option value="w">w</option>
            <option value="divers">divers</option>
          </select>
        </label>
        <label>Kommentar <input name="note" /></label>
        <label>Vererbt?
          <select name="inherited">
            <option>nein</option>
            <option>ja</option>
          </select>
        </label>
        <label>Geerbt von (Code) <input name="inheritedFrom" placeholder="z.â€¯B. 1" /></label>
      </div>
      <div class="hint">Der Ringâ€‘Code wird automatisch generiert: Kinder von â€1â€œ â†’ 1A, 1B, 1C â€¦; Folgegenerationen â†’ Ziffern anfÃ¼gen; Partner â†’ â€xâ€œ-Suffix.</div>
      <div class="hint"><strong>Hinweis:</strong> hat die Person keinen Familienwappenring, bitte im Kommentar vermerken.</div>
      <menu>
        <button type="button" class="btn-cancel" onclick="this.closest('dialog').close()">Abbrechen</button>
        <button id="dlgAddOk" class="primary" type="button">Speichern</button>
      </menu>
    </form>
  </dialog>

  <!-- Dialog: Partner hinzufÃ¼gen -->
  <dialog id="dlgPartner" class="dlg">
    <form id="formPartner">
      <h3>â¤ï¸ Partner hinzufÃ¼gen</h3>
      <div class="grid">
        <label>Partner von Code <input name="personCode" placeholder="z.â€¯B. 1A" /></label>
        <label>Name des Partners <input name="name" /></label>
        <label>Geschlecht
          <select name="gender">
            <option value="">â€“</option>
            <option value="m">m</option>
            <option value="w">w</option>
            <option value="divers">divers</option>
          </select>
        </label>
        <label>Kommentar <input name="note" /></label>
      </div>
      <menu>
        <button type="button" class="btn-cancel" onclick="this.closest('dialog').close()">Abbrechen</button>
        <button id="dlgPartnerOk" class="primary" type="button">Speichern</button>
      </menu>
    </form>
  </dialog>

  <!-- Dialog: Person bearbeiten -->
  <dialog id="dlgEdit" class="dlg">
    <form id="formEdit">
      <h3>âœï¸ Person bearbeiten</h3>
      <div class="grid">
        <label>Personenâ€‘Code <input name="code" readonly /></label>
        <label>Name <input name="name" /></label>
        <label>Geburtsdatum <input name="birthDate" placeholder="TT.MM.JJJJ" /></label>
        <label>Geburtsort <input name="birthPlace" /></label>
        <label>Geschlecht
          <select name="gender">
            <option value="">â€“</option>
            <option value="m">m</option>
            <option value="w">w</option>
            <option value="divers">divers</option>
          </select>
        </label>
        <label>Vererbt?
          <select name="inherited">
            <option>nein</option>
            <option>ja</option>
          </select>
        </label>
        <label>Geerbt von (Code) <input name="inheritedFrom" placeholder="z.â€¯B. 1" /></label>
        <label>Kommentar <input name="note" /></label>
      </div>
      <div class="hint">Ã„nderungen wirken sich sofort auf Tabelle und Baum aus. Personenâ€‘Code ist fix, da er Referenzen (Kinder/Partner) besitzt.</div>
      <menu>
        <button type="button" class="btn-cancel" onclick="this.closest('dialog').close()">Abbrechen</button>
        <button id="dlgEditOk" class="primary" type="button">Speichern</button>
      </menu>
    </form>
  </dialog>

  <!-- Dialog: Export (eigener Text & SchaltflÃ¤chen) -->
  <dialog id="dlgExport" class="dlg">
    <form id="formExport">
      <h3>ğŸ’¾ Export</h3>
      <p>WÃ¤hle deinen Speicherort aus</p>
      <menu>
        <button type="button" class="btn-cancel" onclick="this.closest('dialog').close()">Abbrechen</button>
        <button id="btnExportSaveAs" class="primary" type="button">Speichern unter</button>
        <button id="btnExportDownload" type="button">Im Downloadordner speichern</button>
      </menu>
    </form>
  </dialog>

  <!-- Dialog: Importâ€‘Konflikte -->
  <dialog id="dlgImportConf" class="dlg">
    <form id="formImportConf">
      <h3>âš ï¸ Import â€“ Duplikate</h3>
      <p id="impSummary">Es wurden Duplikate gefunden.</p>
      <fieldset class="choices">
        <label><input type="radio" name="impMode" value="overwrite" checked /> Ãœberschreiben (importierte Daten ersetzen vorhandene)</label>
        <label><input type="radio" name="impMode" value="skip" /> Ãœberspringen (vorhandene behalten)</label>
        <label><input type="radio" name="impMode" value="keepboth" /> Beide behalten (importierte Duplikate mit â€â€‘DUPâ€œ im Personenâ€‘Code)</label>
      </fieldset>
      <menu>
        <button type="button" class="btn-cancel" onclick="this.closest('dialog').close()">Abbrechen</button>
        <button id="dlgImportOk" class="primary" type="button">Fortfahren</button>
      </menu>
    </form>
  </dialog>

  <script src="app.js"></script>
</body>
</html>
