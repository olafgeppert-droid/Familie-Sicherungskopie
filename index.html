<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Familienringe â€“ Stammbaum & Verwaltung</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Login Overlay -->
  <div class="overlay" id="loginOverlay">
    <div class="login-card glass">
      <h2>ğŸ” Familienringe</h2>
      <p>Bitte Passwort eingeben, um die App zu Ã¶ffnen.</p>
      <input id="pwd" type="password" placeholder="Passwort" autocomplete="current-password" />
      <div class="hint">Erstnutzung: beliebiges Passwort setzen. Daten werden lokal <b>AESâ€‘GCM</b>-verschlÃ¼sselt.</div>
      <div id="loginMsg" class="error"></div>
      <menu>
        <button id="btnLogin" class="primary">Anmelden</button>
      </menu>
    </div>
  </div>

  <header class="glass no-print">
    <div class="logo">ğŸ’</div>
    <h1>Familienringe â€“ Stammbaum & Verwaltung</h1>
    <div class="spacer"></div>
    <div class="toolbar">
      <button id="btnImport" title="Import">â¤’ Import</button>
      <button id="btnExport" title="Export">â¤“ Export</button>
      <button id="btnStats" title="Statistiken">ğŸ“Š Statistiken</button>
      <button id="btnRefreshTree" title="Stammbaum aktualisieren">ğŸŒ³ Aktualisieren</button>
      <button id="btnUndo" title="RÃ¼ckgÃ¤ngig">â†¶</button>
      <button id="btnRedo" title="Wiederholen">â†·</button>
    </div>
  </header>

  <main>
    <section id="paneTable" class="pane glass">
      <h3>ğŸ“„ Personen â€“ Tabelle</h3>
      <div class="table-wrap">
        <table id="peopleTable">
          <thead>
            <tr>
              <th>Personenâ€‘Code*</th>
              <th>Name*</th>
              <th>Geburtsdatum</th>
              <th>Geburtsort</th>
              <th>Geschlecht</th>
              <th>Generation</th>
              <th>Elternâ€‘Code</th>
              <th>Partnerâ€‘Codes</th>
              <th>Verbindungsâ€‘Status</th>
              <th>Vererbt?</th>
              <th>Geerbt von</th>
              <th>Kommentar</th>
              <th class="no-print"></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <menu class="no-print">
        <button id="btnAdd">â• Person hinzufÃ¼gen</button>
      </menu>
      <div class="legend hint">
        <b>*Pflichtfelder</b>. Datumsformat: <code>TT.MM.JJJJ</code> (z.â€¯B. 04.12.2000).
      </div>
    </section>

    <section id="paneTree" class="pane glass">
      <h3>ğŸŒ³ Stammbaum</h3>
      <div id="treeContainer" class="tree-container" title="Hover zeigt Details"></div>
      <div class="legend hint">Generationen werden <b>untereinander</b> dargestellt und farblich hervorgehoben.</div>
    </section>
  </main>

  <!-- Edit Dialog -->
  <dialog id="dlgEdit">
    <form method="dialog" id="frmEdit" class="form-grid">
      <h3>Person bearbeiten</h3>
      <label>Personenâ€‘Code* <input name="code" required /></label>
      <label>Name* <input name="name" required /></label>
      <label>Geburtsdatum <input name="birthDate" placeholder="TT.MM.JJJJ" /></label>
      <label>Geburtsort <input name="birthPlace" /></label>
      <label>Geschlecht
        <select name="gender">
          <option value="">â€“</option>
          <option value="m">m</option>
          <option value="w">w</option>
          <option value="d">divers</option>
        </select>
      </label>
      <label>Elternâ€‘Code <input name="parentCode" placeholder="z.â€¯B. 1" /></label>
      <label>Partnerâ€‘Codes (kommagetrennt) <input name="partners" placeholder="z.â€¯B. 1x,2x" /></label>
      <label>Trennungen (Codes) <input name="separated" placeholder="z.â€¯B. 1x" /></label>
      <label>Scheidungen (Codes) <input name="divorced" placeholder="z.â€¯B. 2x" /></label>
      <label>Vererbt?
        <select name="inherited">
          <option value="nein">nein</option>
          <option value="ja">ja</option>
        </select>
      </label>
      <label>Geerbt von (Code) <input name="inheritedFrom" placeholder="z.â€¯B. 1" /></label>
      <label>Kommentar <input name="note" /></label>

      <div class="hint">Pflichtfelder sind markiert. Datumshilfe akzeptiert <code>TT.MM.JJJJ</code>.</div>
      <menu>
        <button type="button" class="btn-cancel" onclick="this.closest('dialog').close()">Abbrechen</button>
        <button id="dlgEditOk" class="primary" type="submit">Speichern</button>
      </menu>
    </form>
  </dialog>

  <!-- Export Dialog -->
  <dialog id="dlgExport">
    <h3>Export</h3>
    <div class="choices">
      <label><input type="radio" name="exfmt" value="json" checked /> JSON</label>
      <label><input type="radio" name="exfmt" value="csv" /> CSV (Tabellendaten)</label>
      <label><input type="radio" name="exfmt" value="pdf" /> PDF (Stammbaum & Statistiken)</label>
    </div>
    <menu>
      <button id="btnExportSaveAs" class="primary">Speichern</button>
      <button id="btnExportShare">TeilenÂ (iOS)</button>
      <button class="btn-cancel" onclick="this.closest('dialog').close()">SchlieÃŸen</button>
    </menu>
  </dialog>

  <!-- Import Dialog -->
  <dialog id="dlgImport">
    <h3>Import</h3>
    <p>JSON oder CSV auswÃ¤hlen. Bei JSON wird der komplette Datenbestand ersetzt.</p>
    <input id="fileImport" type="file" accept=".json,.csv,text/csv,application/json" />
    <menu>
      <button class="btn-cancel" onclick="this.closest('dialog').close()">Abbrechen</button>
    </menu>
  </dialog>

  <!-- Statistik Dialog -->
  <dialog id="dlgStats">
    <h3>ğŸ“Š Statistiken</h3>
    <div id="statsContent"></div>
    <menu>
      <button id="btnStatsPrint">Als PDF drucken</button>
      <button class="btn-cancel" onclick="this.closest('dialog').close()">SchlieÃŸen</button>
    </menu>
  </dialog>

  <script src="app.js"></script>
</body>
</html>
